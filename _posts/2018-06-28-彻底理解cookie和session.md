---
layout: post
title: 搞懂cookie和session
subtitle: cookie && session
date: 2018-06-27
author: Rick
catalog: true
header-img: img/cookie.jpg
tags:
  -cookie session
---

#### 为什么需要cookie
先反问一下，假如没有cookie的话，用户使用web服务会有哪些不方便的地方。比如登录某个站点，用户关闭站点的网页之后，
当下一次再访问该站点时，用户仍然需要再重新登录一遍。另外一个场景是假如购物车，用户在一段时间内添加了某些商品进
购物车中，但没有立即选择付款，当用户下一次再进到来时，购物车却没有记录到相应的信息，用户又需要重新选择商品添加
进购物车中。这些场景给用户带来了诸多不便之处，这就是cookie诞生的原因。有了cookie之后，用户在某段时间内只需要
登录一次即可，用户的一些登录相关信息会被保存到客户端(浏览器)，使得用户体验更好了

### cookie的构成
cookie是由服务端生成的一个key/value结构的数据，内容主要包括名字，值，过期时间，路径和域，里面通常存在着和用户相
关的个人信息。当浏览器第一次访问服务端时，服务端会把这段信息一起带过去给浏览器，浏览器会将这段信息保存在本地，
下次请求同一个域名时，浏览器会自动带上该信息段，服务器就可以识别出具体的用户信息，从而知道是谁在访问。比如将用户登录
时的用户名存储在cookie中，方便服务器去识别用户

### cookie的生命周期
cookie存储的用户信息都有时间限制，在该时间段内，用户可以不输入用户名和密码直接登录。cookie的生命周期取决于
生存cookie时指定的expire值，在这个周期内cookie有效，过期的话浏览器会自动清除。如果不设置expire参数或者将
参数的值设为"0"或负值，那么cookie的只保存到页面关闭之前，一旦页面被关闭，cookie也会被清理掉

### csrf攻击与cookie的关系
csrf攻击是现代Web应用非常常见也是危害性很大的一种攻击方式，其原理是用户C在没有登出A网站的同时去访问了危险站点B，
B站点此时向A站点发起请求，由于用户C并没有登出A站点，浏览器会自动带上A站点的cookie，A站点的服务端由于没有做csrf
的防御手段，这时B站点发起的请求也会被认为是合法的请求，相当于B站点盗取了用户C的身份，从而篡改用户C的数据乃至转移
财产的行为，给用户造成损失。防御csrf攻击的方法一般都是由服务端生成一个token值，并把这个值存在cookie中，用户访问
时要求必须带上token时服务端才会认为这个是合法请求，由于cookie值是无法被其他非同源的第三方获取到的，从而可以识别
出哪些请求是用户自身发出的，哪些是伪造的。

### session是什么
session与cookie不同的是，session采用的是在服务端存储状态信息的一种机制，当客户端访问服务器时，服务器根据需求
设置session， 将会话信息保存在服务器上，同时将标示session的sessionId传递给客户端浏览器，浏览器将这个sessionId
保存在cookie中，浏览器关闭之后，这个Cookie就会被清理掉.session设置好以后，浏览器每次请求都会带上这个sessionId，
服务端根据sessionId就能获取到客户端的数据信息。

### cookie与session的差异
cookie与session都是用于存储会话信息的，只不过两者之间的差异还是很大的， 主要有以下几点

#### 存储方式的不同
cookie是存储在客户端的，对客户端是可见的，因此应该避免在cookie中存储用户密码等敏感信息。而session是存储在服务器的，对
客户的信息是透明的，不存在敏感信息泄露的风险。

#### 有效期的不同
cookie的有效期可以设置为一个比较长的期限，可以数月乃至一年半载都可以，用户在这个有效期内访问都不需要重新登录。而session
依赖的sessionID是存储在cookie的，其过期时间默认是负值，因此只要关闭了浏览器该session就会失效

#### 服务器的压力不同
session是将会话信息保存在服务器中，每个用户都会产生一个session。假如并发数量达到几百万甚至几千万，每个用户的session都
存在服务器的内存中，将耗费大量的内存。而cookie是保存在客户端的，并不会占有服务器的内存，无论并发数量级多大，cookie都
不会耗费服务器的资源。

### 结论
cookie和session都是现代web应用保存会话信息的一种手段，到底如何使用需要按照具体的场景和需求去自行选择。代码是死的，人是
活的，只有根据需求出发选择才是最合适的。
